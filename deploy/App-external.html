<!DOCTYPE html>
<html>
<head>
    <title>StoryMap</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("Rally.ui.cardboard.row.HeaderFix",{override:"Rally.ui.cardboard.row.Header",_getTitle:function(){var value=this.getValue();return null!=value?value.Project.Name+" - "+value.Name:"No Release"}}),Ext.define("StoryMap",{extend:"Rally.app.App",componentCls:"app",launch:function(){app=this,app.releaseArray=[null],app._buildPage()},_buildPage:function(){app.releaseArray=[null];var today=Rally.util.DateTime.toIsoString(new Date);Ext.create("Rally.data.wsapi.Store",{model:"Release",fetch:["Name","ObjectID","Project"],limit:1/0,filters:[{property:"ReleaseDate",operator:">",value:today}],autoLoad:!0,listeners:{load:function(myStore,myData,mySuccess){Ext.Array.each(myData,function(rel){app.releaseArray.push(rel.data)}),app._addNewButton(),app._addBoard(),app._addReleaseButton()},scope:this}})},_addNewButton:function(){app.addButton&&app.addButton.destroy(),addNewConfig={html:'<div><input type="button" style="text-align:right;float:right;" value="Update" onClick="window.location.reload()"/></div>',xtype:"rallyaddnew",newButtonText:"+ New Feature/Story",recordTypes:["User Story","PortfolioItem/Feature"],ignoredRequiredFields:["Name","ScheduleState","Project","Tasks","Dependencies"],listeners:{create:function(addNew,record){app._buildPage()}},showAddWithDetails:!0},app.addButton=this.add(addNewConfig)},_addBoard:function(){this.down("#myBoard")&&this.remove("myBoard"),boardConfig={xtype:"rallycardboard",types:["User Story"],attribute:"Feature",itemId:"myBoard",context:this.getContext(),enableRanking:!0,cardConfig:{fields:["Name","PlanEstimate","ScheduleState"],editable:!0,showIconsAndHighlightBorder:!0,showReadyIcon:!0,showBlockedIcon:!0,showColorIcon:!0,showPlusIcon:!0,showGearIcon:!0},columnConfig:{listeners:{scope:this,beforecarddroppedsave:function(column,card){var rec=card.getRecord();rec.set("PortfolioItem",column.getValue())}}},rowConfig:{field:"Release",enableCrossRowDragging:!0,sortDirection:"ASC",values:app.releaseArray}},app.board=this.add(boardConfig)},_addReleaseButton:function(){app.releaseButton&&app.releaseButton.destroy(),addNewReleaseConfig={html:'<div><input type="button" style="text-align:right;float:right;" value="Update" onClick="window.location.reload()"/></div>',xtype:"rallyaddnew",newButtonText:"+ New Release",recordTypes:["Release"],listeners:{create:function(addNew,record){app._buildPage()}},showAddWithDetails:!0},app.releaseButton=app.add(addNewReleaseConfig)}});

            Rally.launchApp('StoryMap', {
                name:"StoryMap",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
