<!DOCTYPE html>
<html>
<head>
    <title>StoryMap</title>

    <script type="text/javascript" src="/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                var app;Ext.define("StoryMap",{extend:"Rally.app.App",componentCls:"app",launch:function(){app=this,app.releaseArray=[],app._buildPage()},_buildPage:function(){Ext.create("Rally.data.wsapi.Store",{model:"Release",fetch:["Name","ObjectID"],limit:1/0,autoLoad:!0,listeners:{load:function(myStore,myData,mySuccess){Ext.Array.each(myData,function(rel){app.releaseArray.push(rel.data)}),app._addNewButton(),app._addBoard(),app._addReleaseButton()},scope:this}})},_addNewButton:function(){app.addButton&&app.addButton.destroy(),addNewConfig={xtype:"rallyaddnew",newButtonText:"+ New Feature/Story",recordTypes:["User Story","PortfolioItem/Feature"],ignoredRequiredFields:["Name","ScheduleState","Project","Tasks","Dependencies"],listeners:{create:function(addNew,record){app._buildPage()}},showAddWithDetails:!0},app.addButton=this.add(addNewConfig)},_addBoard:function(){app.board&&app.board.destroy(),boardConfig={xtype:"rallycardboard",types:["User Story"],attribute:"Feature",context:this.getContext(),enableRanking:!0,cardConfig:{fields:["Name","PlanEstimate","ScheduleState"],editable:!0,showIconsAndHighlightBorder:!0,showReadyIcon:!0,showBlockedIcon:!0,showColorIcon:!0,showPlusIcon:!0,showGearIcon:!0},columnConfig:{listeners:{scope:this,beforecarddroppedsave:function(column,card){var rec=card.getRecord();rec.set("PortfolioItem",column.getValue())}}},rowConfig:{field:"Release",enableCrossRowDragging:!0,sortDirection:"ASC",values:app.releaseArray}},app.board=this.add(boardConfig)},_addReleaseButton:function(){app.releaseButton&&app.releaseButton.destroy(),addNewReleaseConfig={xtype:"rallyaddnew",newButtonText:"+ New Release",recordTypes:["Release"],listeners:{create:function(addNew,record){app._buildPage()}},showAddWithDetails:!0},app.releaseButton=app.add(addNewReleaseConfig)}});

            Rally.launchApp('StoryMap', {
                name:"StoryMap",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
